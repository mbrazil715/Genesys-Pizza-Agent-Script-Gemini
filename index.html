<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Order Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #e5e7eb;
        }
        .mono-font {
            font-family: 'Roboto Mono', monospace;
        }
        .ticket-edge {
            background-image: linear-gradient(135deg, transparent 5px, white 5px), linear-gradient(225deg, transparent 5px, white 5px);
            background-size: 10px 10px;
            background-repeat: repeat-x;
            background-position: bottom;
            height: 10px;
            width: 100%;
        }
        /* Fade transition for switching modes */
        .fade-enter {
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.3s ease-out, transform 0.3s ease-out;
        }
        .fade-enter-active {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-6 flex flex-col gap-4">

    <!-- Top Bar -->
    <header class="bg-gray-900 text-white p-4 rounded-lg shadow-sm flex justify-between items-center transition-colors duration-300" id="main-header">
        <div class="flex items-center gap-3">
            <div class="bg-red-600 p-2 rounded transition-colors duration-300" id="header-icon-bg">
                <i data-lucide="pizza" class="w-5 h-5 text-white"></i>
            </div>
            <div>
                <h1 class="text-lg font-bold leading-none">Genesys Pizza</h1>
                <span class="text-xs text-gray-400 uppercase tracking-wider">Agent Script</span>
            </div>
        </div>
        <div class="flex items-center gap-4">
            <div class="text-right">
                <p class="text-xs text-gray-400">Order Type</p>
                <p class="font-bold text-green-400 uppercase" id="header-order-type">--</p>
            </div>
        </div>
    </header>

    <!-- Main Grid -->
    <main class="flex-1 grid grid-cols-1 md:grid-cols-12 gap-6 relative">
        
        <!-- LEFT: Customer Panel (4 Columns) -->
        <div class="md:col-span-4 flex flex-col gap-4 h-full">
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
                <div class="bg-gray-50 border-b border-gray-200 p-3 flex items-center justify-between">
                    <span class="text-xs font-bold text-gray-500 uppercase">Customer Profile</span>
                    <i data-lucide="user" class="w-4 h-4 text-gray-400"></i>
                </div>
                <div class="p-5">
                    <div class="flex items-center gap-4 mb-6">
                        <div class="h-12 w-12 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold text-xl">
                            <span id="avatar-initials">--</span>
                        </div>
                        <div>
                            <h2 class="text-xl font-bold text-gray-800" id="display-name">--</h2>
                            <span class="text-sm text-green-600 font-medium bg-green-50 px-2 py-0.5 rounded">Verified Caller</span>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="p-3 bg-gray-50 rounded border border-gray-100">
                            <label class="block text-xs font-semibold text-gray-400 uppercase mb-1">Delivery Address</label>
                            <div class="flex items-start gap-2">
                                <i data-lucide="map-pin" class="w-4 h-4 text-red-500 mt-0.5"></i>
                                <p class="text-sm font-medium text-gray-700" id="display-address">--</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Agent Script Helper -->
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 flex-1 shadow-sm">
                <h3 class="text-sm font-bold text-yellow-800 mb-2 flex items-center gap-2">
                    <i data-lucide="message-square" class="w-4 h-4"></i> Suggested Script
                </h3>
                <p class="text-sm text-yellow-900 leading-relaxed mb-4">
                    "Hello, this is <span class="font-bold">Genesys Pizza</span>. I see you're ordering a <span id="script-size" class="font-bold">--</span> <span id="script-pizza" class="font-bold text-red-700">--</span>. Would you like to add any drinks to that today?"
                </p>
                <div id="script-extra-note" class="hidden mb-4 p-2 bg-white/50 rounded border border-yellow-200 text-xs text-yellow-800 italic">
                    <!-- Dynamic extra notes injected here -->
                </div>
                <button onclick="navigator.clipboard.writeText(document.getElementById('display-address').innerText)" class="w-full bg-white border border-yellow-300 text-yellow-800 text-xs font-bold py-2 rounded hover:bg-yellow-100 transition shadow-sm">
                    Copy Address to Clipboard
                </button>
            </div>
        </div>

        <!-- RIGHT: Order Ticket (8 Columns) -->
        <div class="md:col-span-8 fade-enter" id="ticket-container">
            <div class="bg-white rounded-t-lg shadow-sm border border-gray-200 h-full flex flex-col relative">
                
                <!-- Ticket Header -->
                <div class="p-4 text-white flex justify-between items-center rounded-t-lg transition-colors duration-300" id="ticket-header">
                    <div>
                        <h2 class="font-bold text-lg">Order Details</h2>
                        <p class="text-white/80 text-xs opacity-90">Ticket #<span class="mono-font">8842-B</span></p>
                    </div>
                    <div class="bg-white/20 px-3 py-1 rounded text-sm font-semibold backdrop-blur-sm">
                        Qty: <span id="display-qty" class="mono-font text-lg">--</span>
                    </div>
                </div>

                <!-- Ticket Body -->
                <div class="p-6 flex-1">
                    
                    <!-- Pizza Title Row -->
                    <div class="flex justify-between items-start border-b-2 border-dashed border-gray-200 pb-6 mb-6">
                        <div>
                            <span class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-1 block">Item Selection</span>
                            <h1 class="text-3xl font-extrabold text-gray-900 mb-2 leading-tight" id="display-pizza-name">--</h1>
                            <div class="flex gap-2" id="tags-container">
                                <!-- Tags injected via JS -->
                            </div>
                        </div>
                        <div class="text-right min-w-[100px]">
                             <span class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-1 block">Size</span>
                             <span class="text-3xl font-bold text-gray-800" id="display-size">--</span>
                        </div>
                    </div>

                    <!-- Configuration Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        
                        <!-- Col 1: Base Specs -->
                        <div>
                            <h3 class="text-sm font-bold text-gray-900 border-b border-gray-100 pb-2 mb-3">Base Configuration</h3>
                            <ul class="space-y-4">
                                <li class="flex justify-between text-sm items-center">
                                    <span class="text-gray-500">Crust Style</span>
                                    <span class="font-semibold text-gray-800 bg-gray-100 px-2 py-1 rounded" id="display-crust">--</span>
                                </li>
                                <li class="flex justify-between text-sm items-center">
                                    <span class="text-gray-500">Cut Style</span>
                                    <span class="font-semibold text-gray-800">Normal Cut</span>
                                </li>
                                <li class="flex justify-between text-sm items-center">
                                    <span class="text-gray-500">Bake</span>
                                    <span class="font-semibold text-gray-800">Standard</span>
                                </li>
                            </ul>
                        </div>

                        <!-- Col 2: Dynamic Ingredients (The Page Switcher Part) -->
                        <div class="bg-gray-50 rounded-lg p-4 border border-gray-200 relative overflow-hidden">
                            
                            <!-- VIEW 1: SIGNATURE MODE -->
                            <div id="section-signature" class="hidden h-full flex flex-col">
                                <h3 class="text-sm font-bold text-gray-900 mb-3 flex items-center justify-between border-b border-gray-200 pb-2">
                                    <span>Recipe Notes</span>
                                    <i data-lucide="book-open" class="w-4 h-4 text-gray-400"></i>
                                </h3>
                                <div class="flex-1 flex flex-col justify-center">
                                    <p class="text-sm text-gray-600 italic leading-relaxed mb-4">
                                        "This is a pre-configured signature pie. It contains our standard recipe ingredients for this selection."
                                    </p>
                                    <div class="flex items-start gap-2 text-xs text-red-700 font-semibold bg-red-50 p-3 rounded border border-red-200">
                                        <i data-lucide="alert-circle" class="w-4 h-4 shrink-0"></i>
                                        <span>Standard Recipe Enforced:<br>No substitutions allowed on this item.</span>
                                    </div>
                                </div>
                            </div>

                            <!-- VIEW 2: CUSTOM MODE -->
                            <div id="section-custom" class="hidden h-full flex flex-col">
                                <h3 class="text-sm font-bold text-blue-900 mb-3 flex items-center justify-between border-b border-blue-100 pb-2">
                                    <span>Customer Specifications</span>
                                    <i data-lucide="chef-hat" class="w-4 h-4 text-blue-400"></i>
                                </h3>
                                <div class="flex-1 overflow-y-auto pr-1">
                                    <ul class="space-y-2" id="toppings-list">
                                        <!-- List items injected via JS -->
                                    </ul>
                                </div>
                                <div class="mt-3 pt-3 border-t border-gray-200">
                                    <div class="flex items-center gap-2 text-xs text-green-700 font-medium">
                                        <i data-lucide="check-circle-2" class="w-4 h-4 text-green-500"></i>
                                        Verify all custom items with customer.
                                    </div>
                                </div>
                            </div>

                        </div>

                    </div>
                </div>

                <!-- Ticket Footer Visual -->
                <div class="ticket-edge relative -bottom-1"></div>
            </div>
        </div>

    </main>

    <!-- Floating Toggle for Demo Purposes -->
    <div class="fixed bottom-6 right-6 flex flex-col gap-2 z-50">
        <div class="bg-gray-900 text-white text-xs px-2 py-1 rounded text-center mb-1 shadow-lg opacity-80">Demo Controls</div>
        <button onclick="simulateMode('signature')" class="bg-red-600 hover:bg-red-700 text-white p-3 rounded-full shadow-lg transition-transform hover:scale-105 flex items-center gap-2">
            <i data-lucide="flame" class="w-5 h-5"></i>
            <span class="text-xs font-bold pr-1">Signature</span>
        </button>
        <button onclick="simulateMode('custom')" class="bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full shadow-lg transition-transform hover:scale-105 flex items-center gap-2">
            <i data-lucide="tools" class="w-5 h-5"></i>
            <span class="text-xs font-bold pr-1">Custom</span>
        </button>
    </div>

    <script>
        lucide.createIcons();

        // Standard Init
        function getQueryParams() {
            const params = new URLSearchParams(window.location.search);
            // DEFAULT MOCK DATA (Starting state)
            return {
                customerName: params.get('customerName') || "Alex Johnson",
                deliveryAddress: params.get('deliveryAddress') || "742 Evergreen Terrace, Springfield",
                pizzaType: params.get('pizzaType') || "Signature", 
                signatureSelection: params.get('signatureSelection') || "BBQ Chicken Feast",
                toppings: params.get('toppings') || "Pepperoni,Mushrooms,Green Peppers,Extra Cheese",
                size: params.get('size') || "Large",
                quantity: params.get('quantity') || "2",
                crustType: params.get('crustType') || "Hand Tossed"
            };
        }

        // Global state for simulation
        let currentData = getQueryParams();

        function render(data) {
            // 1. Header & Common Data
            const isSignature = data.pizzaType.toLowerCase() === 'signature';
            
            // Header Color Logic
            const ticketHeader = document.getElementById('ticket-header');
            const headerOrderType = document.getElementById('header-order-type');
            
            if (isSignature) {
                ticketHeader.className = "p-4 text-white flex justify-between items-center rounded-t-lg bg-red-600 shadow-md";
                headerOrderType.textContent = "Signature";
                headerOrderType.className = "font-bold text-red-500 uppercase bg-red-100 px-2 py-1 rounded";
            } else {
                ticketHeader.className = "p-4 text-white flex justify-between items-center rounded-t-lg bg-blue-600 shadow-md";
                headerOrderType.textContent = "Custom Build";
                headerOrderType.className = "font-bold text-blue-500 uppercase bg-blue-100 px-2 py-1 rounded";
            }

            document.getElementById('display-qty').textContent = data.quantity;
            document.getElementById('display-size').textContent = data.size;
            document.getElementById('display-crust').textContent = data.crustType;
            
            // 2. Customer Data
            document.getElementById('display-name').textContent = data.customerName;
            document.getElementById('display-address').textContent = data.deliveryAddress;
            const initials = data.customerName.split(' ').map(n => n[0]).join('').substring(0,2).toUpperCase();
            document.getElementById('avatar-initials').textContent = initials;

            // 3. Logic: Signature vs Custom
            const tagsContainer = document.getElementById('tags-container');
            const scriptPizza = document.getElementById('script-pizza');
            const scriptNote = document.getElementById('script-extra-note');
            
            tagsContainer.innerHTML = ''; // Clear

            // Animation re-trigger
            const ticketContainer = document.getElementById('ticket-container');
            ticketContainer.classList.remove('fade-enter-active');
            void ticketContainer.offsetWidth; // trigger reflow
            ticketContainer.classList.add('fade-enter-active');

            if (isSignature) {
                // --- SIGNATURE MODE ---
                document.getElementById('display-pizza-name').textContent = data.signatureSelection;
                
                tagsContainer.innerHTML = `
                    <span class="px-2 py-1 bg-red-100 text-red-700 text-xs font-bold rounded uppercase border border-red-200">Signature</span>
                    <span class="px-2 py-1 bg-orange-100 text-orange-700 text-xs font-bold rounded uppercase border border-orange-200">Premium</span>
                `;

                document.getElementById('section-signature').classList.remove('hidden');
                document.getElementById('section-custom').classList.add('hidden');

                scriptPizza.textContent = data.signatureSelection;
                scriptNote.classList.add('hidden');

            } else {
                // --- CUSTOM MODE ---
                document.getElementById('display-pizza-name').textContent = "Build Your Own";

                tagsContainer.innerHTML = `
                    <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs font-bold rounded uppercase border border-blue-200">Custom</span>
                    <span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs font-bold rounded uppercase border border-gray-200">Verified</span>
                `;

                document.getElementById('section-signature').classList.add('hidden');
                document.getElementById('section-custom').classList.remove('hidden');

                // Generate Toppings List
                const list = document.getElementById('toppings-list');
                const toppings = data.toppings.split(',');
                list.innerHTML = ''; 

                if (toppings.length > 0 && toppings[0] !== "") {
                    toppings.forEach(t => {
                        const li = document.createElement('li');
                        li.className = "flex items-center gap-3 text-sm text-gray-700 bg-white p-2 rounded border border-gray-100 shadow-sm";
                        li.innerHTML = `
                            <div class="h-5 w-5 rounded-full bg-blue-50 flex items-center justify-center shrink-0">
                                <i data-lucide="check" class="w-3 h-3 text-blue-600"></i>
                            </div>
                            <span class="font-medium">${t.trim()}</span>
                        `;
                        list.appendChild(li);
                    });
                } else {
                    list.innerHTML = `<li class="text-sm text-gray-400 italic p-2">Cheese Only (No extra toppings)</li>`;
                }

                scriptPizza.textContent = "Custom Pizza";
                scriptNote.classList.remove('hidden');
                scriptNote.innerHTML = `<strong>Note:</strong> Read back toppings: "${data.toppings}"`;
            }

            document.getElementById('script-size').textContent = data.size;

            lucide.createIcons();
        }

        // SIMULATION CONTROLS
        function simulateMode(mode) {
            const newData = { ...currentData }; // clone
            
            if (mode === 'signature') {
                newData.pizzaType = 'Signature';
                newData.signatureSelection = "BBQ Chicken Feast";
                newData.toppings = ""; 
            } else {
                newData.pizzaType = 'Custom';
                newData.toppings = "Italian Sausage,Red Onions,Green Peppers,Mushrooms,Mozzarella";
                newData.signatureSelection = "";
            }
            render(newData);
        }

     // ===============================
// GENESYS CLOUD INITIALIZATION
// ===============================
window.ININ = window.ININ || {};

ININ.core.on('init', async function (data) {
    console.log("Genesys init received", data);

    try {
        const conversationId = data.conversationId;
        const participantId = data.participantId;
        const accessToken = data.accessToken;
        const environment = data.environment; // e.g. mypurecloud.com

        const response = await fetch(
            `https://api.${environment}/api/v2/conversations/calls/${conversationId}/participants/${participantId}/attributes`,
            {
                headers: {
                    'Authorization': `Bearer ${accessToken}`
                }
            }
        );

        const attributes = await response.json();
        console.log("Participant attributes:", attributes);

        // ðŸ”½ Map Genesys Participant Data â†’ Your UI data model
        currentData = {
            customerName: "Caller",
            deliveryAddress: attributes.DeliveryAddressSlotVar || "--",
            pizzaType: attributes.PizzaToppingSlotVar ? "Custom" : "Signature",
            signatureSelection: attributes.PizzaToppingSlotVar ? "" : "BBQ Chicken Feast",
            toppings: attributes.PizzaToppingSlotVar || "",
            size: attributes.PizzaSizeSlotVar || "--",
            quantity: attributes.PizzaQuantitySlotVar || "--",
            crustType: attributes.CrustSlotVar || "--"
        };

        // ðŸ”¥ Render UI with REAL bot data
        render(currentData);

    } catch (err) {
        console.error("Failed to load Genesys participant data", err);

        // Fallback so UI still loads
        render(currentData);
    }
});
    </script>
</body>
</html>
